/jules

You are an autonomous AI coding agent ("Jules") tasked with a large-scale, asynchronous refactoring project.

## 1. OBJECTIVE
Execute a full thematic refactor of the codebase as defined in `REFACTOR_BLUEPRINT.md`. The goal is to transform a "Civilization Game" into a "Corporate Decision Simulator" (CDS).

## 2. CONTEXT & FILES
* **Primary Instruction Set:** `REFACTOR_BLUEPRINT.md` (Read this first and follow it strictly).
* **Source Code:** All files located in the `old_codebase/` directory.
* **Output Destination:** A new directory you will create, `new_codebase/`.
* **Final Deliverable:** A new GitHub branch named `feat/corporate-sim-refactor-v1` containing the completed `new_codebase/`.

## 3. CORE EXECUTION PLAN
1.  **Create Branch:** Start by creating a new GitHub branch: `feat/corporate-sim-refactor-v1`.
2.  **Create Directory:** Create the `new_codebase/` directory at the project root.
3.  **Iterate and Refactor:** Process *every file* from `old_codebase/`.
    * **Discard:** If a file is on the "Discardable Systems" list in the blueprint (e.g., `visual_engine.py`), **do not** copy it.
    * **Copy & Refactor:** For all other files, copy them to the *identical* path within `new_codebase/` (e.g., `old_codebase/engines/faction_engine.py` -> `new_codebase/engines/faction_engine.py`).
    * **Apply Transformations:** Open the *new* file in `new_codebase/` and apply all relevant transformations from the blueprint.

## 4. TRANSFORMATION RULES

* **For `.py` (Code) Files:**
    * Apply all variable, class, and function name changes from the blueprint (e.g., `civilization.population` -> `company.headcount`).
    * Remove all imports and function calls related to "Discardable Systems."
    * **Apply Code Quality Standards (see section 5).**

* **For `.json` (Data) Files:**
    * Rename the *filename* as specified in the blueprint (e.g., `factions.json` -> `departments.json`).
    * Open the new file and rename *every key* inside it to match the blueprint's mapping (e.g., `faction.name` -> `department.name`).

* **For `.txt` (Prompt) Files:**
    * This is the most critical creative task. **Do not** simply edit the old text.
    * **Delete the old content** and rewrite the *entire prompt from scratch*.
    * The new prompt must perfectly match the "Corporate" persona, professional lexicon, and strategic context defined in the blueprint (e.g., "famine" becomes "budget freeze").
    * Crucially, all new prompts must incorporate the **"Player Ladder"** logic (Step 3.1 in the blueprint), ensuring events are scoped to the user's role (Junior, Manager, CEO).

## 5. CODE QUALITY STANDARDS
You must write code that is easy for another AI to test and diagnose.
* **Documentation:** Add clear, concise docstrings for all refactored functions.
* **Comments:** Add in-line comments explaining *why* a piece of logic exists, especially for complex calculations (e.g., `# Calculate department morale drop based on budget delta`).
* **Labeling:** Use clean, descriptive variable names that match the blueprint (e.g., `political_capital_gain`).
* **Simplicity:** Favor clear, readable code over complex one-liners.

## 6. RESILIENCE & AUTONOMY PROTOCOLS
This is a long-running task. You must handle errors gracefully.
* **Define "Edit Cycle":** An "edit cycle" is one attempt to fix a single file that has failed a test or validation.
* **Protocol 6.1 (Loop Detection):** If you find yourself stuck on a *single file* (e.g., a complex prompt rewrite) and you fail to get it right after **3 consecutive edit cycles**, you must enact the "reset and escalate" protocol.
* **Protocol 6.2 (Reset and Escalate):**
    1.  **Stop:** Stop editing the problematic file.
    2.  **Analyze:** Write an internal analysis (for your own context, not in the code) of *why* it's failing (e.g., "The prompt for `council_engine.py` is too complex and the logic is circular").
    3.  **Attempt 2 (Delete & Regenerate):** Delete the problematic section (e.g., the entire prompt text) and generate a *new, simpler version* from scratch that still meets the blueprint's high-level goal.
* **Protocol 6.3 (Workaround):**
    1.  If the "Delete & Regenerate" attempt fails again, **move on.**
    2.  Delete the problematic file from `new_codebase/`.
    3.  Create a new file `REFACTOR_ISSUES.md` in the `new_codebase/` directory.
    4.  Add a bullet point: `- FAILED: [path/to/file] - Could not refactor. Skipped.`
    5.  Continue to the next file in the queue.

## 7. FINAL OUTPUT
* Commit all changes to the `feat/corporate-sim-refactor-v1` branch.
* The `REFACTOR_ISSUES.md` file (if it exists).
* Report back here with a "TASK_COMPLETE" message.